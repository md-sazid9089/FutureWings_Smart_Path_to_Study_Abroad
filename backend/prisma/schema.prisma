generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ─── Enums ───────────────────────────────────────────────

enum Role {
  USER
  ADMIN
}

// ─── User ────────────────────────────────────────────────

model User {
  id          Int      @id @default(autoincrement())
  email       String   @unique
  password    String
  role        Role     @default(USER)
  fullname    String?
  cgpa        Float?
  degreeLevel String?
  major       String?
  fundScore   Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  documents    UserDocument[]
  applications Application[]
  ratings      CountryRating[]
}

// ─── Country ─────────────────────────────────────────────

model Country {
  id          Int      @id @default(autoincrement())
  name        String
  code        String   @unique
  description String?  @db.Text
  isActive    Boolean  @default(true)
  tier        Int      @default(1)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  universities University[]
  scholarships Scholarship[]
  applications Application[]
  ratings      CountryRating[]
}

// ─── University ──────────────────────────────────────────

model University {
  id        Int      @id @default(autoincrement())
  name      String
  countryId Int
  location  String?
  ranking   Int?
  website   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  country  Country   @relation(fields: [countryId], references: [id])
  programs Program[]
}

// ─── Program ─────────────────────────────────────────────

model Program {
  id           Int      @id @default(autoincrement())
  name         String
  universityId Int
  degreeLevel  String
  duration     String?
  tuitionFee   Float?
  description  String?  @db.Text
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  university   University    @relation(fields: [universityId], references: [id])
  applications Application[]
}

// ─── Scholarship ─────────────────────────────────────────

model Scholarship {
  id          Int       @id @default(autoincrement())
  name        String
  countryId   Int
  amount      Float?
  eligibility String?   @db.Text
  deadline    DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  country Country @relation(fields: [countryId], references: [id])
}

// ─── UserDocument ────────────────────────────────────────

model UserDocument {
  id       Int    @id @default(autoincrement())
  userId   Int
  fileName String
  fileType String
  filePath String
  status   String @default("Pending") // Pending | Verified | Rejected
  note     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
}

// ─── ApplicationStatus ──────────────────────────────────

model ApplicationStatus {
  id   Int    @id @default(autoincrement())
  name String @unique

  createdAt DateTime @default(now())

  applications Application[]
}

// ─── Application ─────────────────────────────────────────

model Application {
  id            Int      @id @default(autoincrement())
  userId        Int
  countryId     Int
  programId     Int
  statusId      Int
  intakeApplied String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user        User              @relation(fields: [userId], references: [id])
  country     Country           @relation(fields: [countryId], references: [id])
  program     Program           @relation(fields: [programId], references: [id])
  status      ApplicationStatus @relation(fields: [statusId], references: [id])
  visaOutcome VisaOutcome?
}

// ─── VisaOutcome ─────────────────────────────────────────

model VisaOutcome {
  id            Int    @id @default(autoincrement())
  applicationId Int    @unique
  outcome       String // Approved | Denied
  note          String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  application Application @relation(fields: [applicationId], references: [id])
}

// ─── CountryRating ───────────────────────────────────────

model CountryRating {
  id            Int      @id @default(autoincrement())
  userId        Int
  applicationId Int
  countryId     Int
  ratingValue   Int      // 1-5
  comments      String?  @db.Text
  createdAt     DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id])
  country Country @relation(fields: [countryId], references: [id])
}
